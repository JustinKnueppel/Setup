---
- name: Check if prezto is downloaded
  stat:
    path: ~/.zprezto
  register: file_exists

- name: Download prezto
  git:
    repo: https://github.com/sorin-ionescu/prezto.git
    dest: ~/.zprezto
    recursive: yes
  when: file_exists.stat.exists == False
  
- name: Link config files
  script: copy_zsh_files.zsh
  args:
    executable: /usr/bin/env zsh
  
- name: Edit preferences
  script: edit_zprezto.sh
  args:
    executable: /usr/bin/env bash

- name: zsh facts
  shell: 'echo $SHELL'
  register: default_shell
  # changed when determines when will this task be considered changed when running
  # ansible. In this case, we want it to always be false, as we are just
  # retrieving information.
  changed_when: False
  sudo: no

- name: Make zsh default
  shell: chsh -s /bin/zsh
  when: default_shell.stdout.find('/bin/zsh') == -1
...